(function(a){a.themify_tiles={debounce:function(c,e,b){var d;return function(){var h=this,g=arguments;var f=function(){d=null;if(!b){c.apply(h,g)}};if(b&&!d){c.apply(h,g)}clearTimeout(d);d=setTimeout(f,e)}},resizeParent:function(c){var b=c.children(".post"),d=b.last();c.css("height",d.outerHeight(true)+d.css("position","absolute").position().top);setTimeout(function(){c.css("height",d.outerHeight(true)+d.position().top);b.css({position:"absolute",opacity:1});c.addClass("loading-finish").removeClass("tiles_resing");c.trigger("auto_tiles_ready.themify")},Math.round(parseFloat(c.css("transition-duration"))*1000)+300)},setBackstretch:function(c,b){if("undefined"!==typeof a.fn.backstretch&&"undefined"!==typeof a.fn.imagesLoaded){b.imagesLoaded().always(function(){b.find(".post:visible").each(function(){var e=a(this).find(".post-image"),d=e.find("img"),h=d.prop("src");if(h){e.backstretch(h);var g=e.find("a"),f=g;g.remove();d.remove();e.find("img").wrap(f)}})})}}};setClasses=function(c,b){c.each(function(){var e=a(this).width(),d=a(this).height();if(e-10<=b){if(e===d){a(this).addClass("tiled-square-small")}else{if(d>e){a(this).addClass("tiled-portrait")}}}else{if(e>b){if(e>d){a(this).addClass("tiled-landscape")}else{a(this).addClass("tiled-square-large")}}}})};a.fn.extend({grids:{},grid:false,curr_large_template:false,small_screen_grid:false,opts:{},using_small:false,SetTemplateByCount:function(j,d,f){f=f>0?f:j.children(".post:visible").length;var h=[];if(d[f]){return d[f]}if(f!=10){if(f>10){var e=f>13?13:10,g=f%e,b=parseInt(f/e);if(b>0){$items=d[e];for(var i=0;i<b;i++){for(var c in $items){h.push($items[c])}}}if(g>0){for(var c in d[g]){h.push(d[g][c])}}}}return f>10?h:d[f]},update:function(){var c=a(this).children(".post:visible");this.grid.tiles=[];var b=this.SetTemplateByCount(this,this.opts.grids[this.opts.default_grid],c.length);this.curr_large_template=Tiles.Template.fromJSON(b);this.grid.template=this.get_template();this.grid.isDirty=true;this.grid.updateTiles(c);this.grid.redraw(this.opts.animate_template,a.themify_tiles.setBackstretch,a(this))},onresize:function(c,b){a.themify_tiles.resizeParent(b);a.themify_tiles.setBackstretch(c,b)},get_template:function(){var b;if(!this.curr_large_template){this.curr_large_template=this.grids[this.opts.default_grid]}if(!this.opts.breakpoint){return this.curr_large_template}b=a(this).width()<this.opts.breakpoint;if(b&&!this.using_small){this.using_small=true;return this.small_screen_grid}else{if(!b&&this.using_small){this.using_small=false;return this.curr_large_template}}return(b)?this.small_screen_grid:this.curr_large_template},themify_tiles:function(g,d){var f=a(this),h=this,b=false;if(g.breakpoint&&g.small_screen_grid){this.small_screen_grid=Tiles.Template.fromJSON(g.small_screen_grid)}var e=f.children(".post");this.opts=g;var c=a.extend(true,{},g.grids);b=c[g.default_grid]=this.SetTemplateByCount(f,c[g.default_grid],e.length);a.each(c,function(i){h.grids[i]=Tiles.Template.fromJSON(this)});this.grid=a.extend(new Tiles.Grid(f),{cellPadding:parseInt(h.opts.padding),template:h.get_template(),templateFactory:{get:function(p,m){var n=h.get_template().copy(),j=m-n.rects.length;while(j>0){var o=[],l,k=h.get_template().copy();if(j<=k.rects.length){o=k.rects;j=0}else{for(l=0;l<k.rects.length;l++){o.push(k.rects[l].copy())}j-=k.rects.length}n.append(new Tiles.Template(o,k.numCols,k.numRows))}return n}},resizeColumns:function(){return this.template.numCols},createTile:function(j){var i=new Tiles.Tile(j.id,j);i.$el.find(".post-image img").css("opacity","0");return i}});this.grid.updateTiles(e);this.grid.redraw(this.opts.animate_init,this.onresize,this);f.off("infiniteloaded.themify").on("infiniteloaded.themify",function(l,i){if(i.closest(".auto_tiles").length>0){var k=LayoutAndFilter?LayoutAndFilter.filterActive:false;if(k){LayoutAndFilter.filterActive=false}var m=b[b.length-1],p=h.SetTemplateByCount(f,h.opts.grids[h.opts.default_grid],i.length);p=a.extend(true,{},p);if(m===p[0]){var t=p[0].length-1,j={},q=["X","Y","Z","V","T","F","K"];for(var o=0;o<t;o++){var v=p[0].charAt(o);if(v!=="."){j[v]=q[o]}}for(var n in j){var u=new RegExp(n,"g");p[0]=p[0].replace(u,j[n])}if(p[1]&&p[1]===m){p[1]=p[0]}}for(var s in p){b.push(p[s])}h.curr_large_template=Tiles.Template.fromJSON(b);if(k){var r=f.children(".post");h.grid.tiles=[];h.grid.updateTiles(r)}else{h.grid.addTiles(i.get())}h.grid.template=h.get_template();h.grid.isDirty=true;h.grid.redraw(h.opts.animate_template,h.onresize,h);if(k){LayoutAndFilter.filterActive=k}setClasses(i,d)}}).data("themify_tiles",this);a(window).on("debouncedresize",function(i){if(!i.isTrigger){h.grid.template=h.get_template();h.grid.isDirty=true;h.grid.resize();h.addClass("tiles_resing");h.grid.redraw(g.animate_resize,h.onresize,h)}})}})})(jQuery);